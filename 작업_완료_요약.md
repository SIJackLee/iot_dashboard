# 인증/권한 제거 및 UI/UX 개선 작업 완료

## 삭제한 파일 목록

1. ✅ `app/login/page.tsx` - 로그인 페이지
2. ✅ `app/api/auth/[...nextauth]/route.ts` - NextAuth API
3. ✅ `lib/authz.ts` - 권한 체크 유틸리티
4. ✅ `middleware.ts` - 인증 미들웨어

---

## 수정한 파일 목록

### API Routes (인증 체크 제거)
1. ✅ `app/api/health/route.ts` - requireSession 제거
2. ✅ `app/api/farms/summary/route.ts` - 권한 체크 제거, 모든 농장 조회
3. ✅ `app/api/farms/[registNo]/detail/route.ts` - 권한 체크 제거
4. ✅ `app/api/rooms/[key12]/route.ts` - 권한 체크 제거
5. ✅ `app/api/rooms/[key12]/logs/route.ts` - 권한 체크 제거

### 페이지 컴포넌트
6. ✅ `app/farms/page.tsx` - useSession 제거, OfflineBanner 추가, 정렬 개선
7. ✅ `app/farms/[registNo]/page.tsx` - useSession 제거, AlertsPanel 추가, Button 적용
8. ✅ `app/providers.tsx` - SessionProvider 제거
9. ✅ `app/rooms/[key12]/page.tsx` - Button, Card, Tabs 적용

### UI 컴포넌트
10. ✅ `components/shell/TopBar.tsx` - 사용자 표시/로그아웃 제거
11. ✅ `components/farms/FarmSummaryFilters.tsx` - 정렬 옵션 추가 (위험, 최신성)
12. ✅ `components/rooms/RoomDetailDrawer.tsx` - Button 적용

### 새로 생성한 컴포넌트
13. ✅ `components/farms/OfflineBanner.tsx` - 전부 오프라인 시 배너
14. ✅ `components/farms/AlertsPanel.tsx` - offline/danger 알림 패널

### 설정 파일
15. ✅ `package.json` - next-auth, bcryptjs, next-themes 제거
16. ✅ `.env.local.example` - NEXTAUTH_* 제거
17. ✅ `README_SETUP.md` - 로그인 관련 내용 제거, UI/UX 테스트 기준으로 재작성

---

## 핵심 변경 사항

### 1. 인증 완전 제거
- 모든 API는 인증 없이 동작
- 모든 페이지는 인증 없이 접근 가능
- 로그인 페이지 제거

### 2. 권한 로직 제거
- 모든 농장 데이터 접근 가능
- owner/admin 구분 없음
- URL 변조 방지 로직 제거

### 3. UI 개선
- **OfflineBanner**: 전부 오프라인 시 경고 배너 표시
- **AlertsPanel**: offline/danger만 모아서 표시
- **정렬 개선**: 위험 수, 최신성 정렬 추가
- **shadcn/ui 적용**: Button, Card, Tabs, Alert 등

---

## 로컬 실행 방법

```bash
cd Local_PC/iot-dashboard
npm install
npm run dev
```

브라우저에서 `http://localhost:3000` 접속 → 바로 `/farms` 페이지로 이동

**환경 변수 설정:**
`.env.local` 파일 생성:
```env
SUPABASE_URL=https://ompufmezugftzoergdbn.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
OFFLINE_TH_DEFAULT_SEC=211
OFFLINE_CACHE_TTL_SEC=300
OFFLINE_LOOKBACK_MIN=120
```

---

## UI 동작 확인 체크리스트

### 1. 기본 플로우
- [ ] 루트 (`/`) → `/farms` 자동 리다이렉트
- [ ] `/farms` 페이지 로드 (인증 없이)
- [ ] KPI 카드 표시 (정상/경고/위험/오프라인)
- [ ] 검색 필터 작동 (FARMxx 검색)
- [ ] 정렬 필터 작동 (농장번호/총방수/오프라인/위험/최신성)
- [ ] 농장 테이블 표시
- [ ] 15초 자동 갱신

### 2. OfflineBanner
- [ ] 전부 오프라인일 때 배너 표시
- [ ] 마지막 업데이트 시간 표시

### 3. 농장 상세
- [ ] `/farms/[registNo]` 페이지 로드
- [ ] KPI 카드 표시
- [ ] AlertsPanel 표시 (offline/danger만)
- [ ] Stall 탭 전환 (1/2/3)
- [ ] Room 그리드 표시 (20개)
- [ ] 3초 자동 갱신

### 4. Room Drawer
- [ ] RoomCard 클릭 시 Drawer 열림
- [ ] 센서 5종 배열 표로 표시
- [ ] 모터 (EC01 + activeVent + 비활성 null) 표시
- [ ] "방 상세 페이지 이동" 버튼 작동

### 5. 방 상세 페이지
- [ ] `/rooms/[key12]` 페이지 로드
- [ ] 기본 정보 Card 표시
- [ ] 센서/모터 패널 표시
- [ ] Tabs로 시간 범위 선택 (1시간/24시간)
- [ ] 트렌드 차트 표시
- [ ] 5초 자동 갱신

### 6. 반응형
- [ ] 모바일 (< 640px): KpiCards 1열, Filters 세로 배치
- [ ] 태블릿 (640px - 1024px): KpiCards 2열
- [ ] 데스크톱 (> 1024px): KpiCards 4열

---

## 유지된 기능

✅ **Backend2 API Routes** - 모든 기능 유지
✅ **시간대 KST 규칙** - serverNowKst, measureTsKst 등
✅ **센서/모터 표시 규칙** - Full DTO 구조
✅ **요약/상세 분리** - 15초/3초 폴링
✅ **OFFLINE 판정** - p95 기반 동적 임계값 (211초 기본)
✅ **shadcn/ui 컴포넌트** - 모든 마이그레이션 유지

---

## 다음 단계 (Phase 2)

인증/권한 시스템 재설계:
- 새로운 인증 방식 선택
- 권한 테이블 재설계
- API Routes에 인증 체크 재추가
- 사용자별 데이터 접근 제한

---

## 참고

- 현재는 UI/UX 구현에만 집중
- 모든 데이터 접근 가능 (로컬 테스트 환경)
- Phase 2에서 보안 강화 예정
- Supabase SERVICE_ROLE_KEY는 여전히 서버에서만 사용
