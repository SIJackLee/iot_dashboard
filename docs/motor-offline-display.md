# 모터 제어 화면 – OFFLINE 시 데이터 표시 방안

## 배경

- **OFFLINE** = `freshnessSec > offlineThSec` (스냅샷이 오래되어 단말/방이 응답 불가로 간주).
- API는 OFFLINE이어도 **마지막 저장된 스냅샷**을 그대로 반환함.
- 그 결과, **이전 명령값(이전 RPM)** 으로 “현재 RPM”과 돼지/팬 애니메이션이 계속 실행되는 문제가 있음.

따라서 OFFLINE일 때는 “실시간 값”이 아님을 분명히 하고, 모든 데이터를 일관된 원칙으로 표시하는 방안이 필요함.

---

## 원칙

1. **실시간 아님을 명시**: OFFLINE이면 “현재 값”이 아니라 “마지막으로 알려진 값”임을 UI/문구로 구분.
2. **애니메이션 중단 또는 비활성 표시**: 실제 상태를 모르므로 “지금 돌아가고 있다”는 인상을 주지 않음.
3. **명령은 허용 가능**: OFFLINE이어도 사용자가 명령을 보낼 수는 있음. 다만 “적용 여부는 확인 불가”로 표시.

---

## 데이터별 OFFLINE 표시 방안

### 1. 방 상태(배지)

| 항목       | 온라인 시              | OFFLINE 시                    |
|------------|------------------------|-------------------------------|
| 상태 배지  | NORMAL / WARN / DANGER | **OFFLINE** (회색 계열, 명확한 라벨) |
| 비고       | -                      | “데이터 갱신 중단” 등 짧은 안내 문구 권장 |

- 상단/헤더에 **OFFLINE** 배지를 두고, 가능하면 `freshnessSec` 또는 “마지막 수신 시각”을 함께 표시하면 좋음.

---

### 2. 현재 RPM (ec01 / ec02 / ec03)

| 항목       | 온라인 시        | OFFLINE 시                                      |
|------------|------------------|--------------------------------------------------|
| 표시 값    | 실제 RPM 숫자    | **"—"** 또는 **"구간 불명"** 등으로 통일        |
| 대안       | -                | 마지막 스냅샷 값을 쓰는 경우 반드시 **"(마지막 알림)"** 등 보조 문구 표기 |

**권장**: OFFLINE이면 **RPM 숫자를 숨기고 "—" 또는 "구간 불명"** 으로 두고, 툴팁/보조 문구로 “장비 응답 없음, 마지막 알림값 미표시” 등 안내.

---

### 3. 돼지 흔들림 애니메이션

| 항목       | 온라인 시              | OFFLINE 시                    |
|------------|------------------------|--------------------------------|
| 애니메이션 | 퍼센트에 따라 실행     | **실행하지 않음** (정지 상태)  |

- **이유**: 실제 RPM을 모르므로 “지금 75%로 돌고 있다”처럼 보이면 안 됨.
- 구현: `state === "offline"` 이면 `pigShakeAnim = null` 로 두어 흔들림 없음.

---

### 4. 팬 회전 애니메이션

| 항목       | 온라인 시              | OFFLINE 시                    |
|------------|------------------------|--------------------------------|
| 애니메이션 | RPM/퍼센트에 따라 회전 | **정지** 또는 **회전 비표시**  |

- **이유**: 위와 동일. “팬이 돌고 있다”는 인상을 주지 않음.
- 구현: OFFLINE이면 `fanDuration = 0` 또는 회전 애니메이션 비활성.

---

### 5. 돼지 밀림/기울기 (pigTilt, pigTranslate)

| 항목       | 온라인 시        | OFFLINE 시                    |
|------------|------------------|--------------------------------|
| 표시       | visualPct 기준   | **0 (기본 자세)** 권장        |

- **이유**: “지금 풍량이 많다/적다”를 반영할 근거가 없음.
- 구현: OFFLINE이면 `pigTilt = 0`, `pigTranslate = 0`.

---

### 6. 슬라이더 / 프리셋 버튼

| 항목           | 온라인 시 | OFFLINE 시 |
|----------------|-----------|------------|
| 슬라이더 값    | 유지      | 유지 (또는 0으로 리셋 정책 가능) |
| 프리셋/전송    | 사용 가능 | **사용 가능** (명령 전송은 허용) |
| 안내           | -         | “장비가 오프라인입니다. 명령 전송 후 적용 여부는 확인할 수 없습니다.” 등 |

- 명령 자체는 막지 않고, **상태 문구만** OFFLINE에 맞게 변경.

---

### 7. 명령 상태 문구

| 항목           | 온라인 시     | OFFLINE 시 |
|----------------|---------------|------------|
| "[명령 전달]"  | 그대로 표시   | 표시 가능 + “오프라인: 적용 확인 불가” 등 보조 문구 |
| "[명령 적용]"  | ACKED 시 표시 | ACKED여도 “장비 오프라인으로 실제 적용 여부 불명” 등 안내 권장 |

---

### 8. 타이밍 정보 (있는 경우)

| 항목              | 온라인 시     | OFFLINE 시 |
|-------------------|---------------|------------|
| 마지막 갱신 시각  | 표시          | 표시 + **“응답 없음 (OFFLINE)”** 강조 |
| freshnessSec      | 배지/툴팁 등  | “N초간 미갱신” 등으로 표시해 OFFLINE 이유 부여 |

---

## 구현 시 필요한 전제

1. **모터 페이지에서 `state` 사용**
   - `GET /api/rooms/[key12]` 응답의 `state`를 모터 페이지까지 내려줌.
2. **MotorControlPanel**
   - `roomState?: RoomState` (또는 `isOffline?: boolean`) prop 추가.
3. **MotorControlDemoView / FloorLayer**
   - `isOffline`(또는 `roomState === "offline"`)일 때:
     - RPM 텍스트: `"—"` 또는 “구간 불명”.
     - `pigShakeAnim = null`, `pigTilt = 0`, `pigTranslate = 0`, 팬 회전 비활성.

---

## 요약 표

| 데이터/UI         | OFFLINE 시 동작 |
|------------------|------------------|
| 방 상태 배지     | OFFLINE 표시 + (선택) 마지막 갱신 시각 |
| 현재 RPM         | "—" 또는 "구간 불명" (숫자 비표시 권장) |
| 돼지 흔들림      | 중단 (null) |
| 팬 회전          | 중단 (0 또는 비표시) |
| 돼지 밀림/기울기 | 0 (기본 자세) |
| 슬라이더/명령    | 사용 가능 + “적용 확인 불가” 안내 |

이 방안을 적용하면 OFFLINE일 때 이전 명령값으로 인한 “현재 RPM & 애니메이션” 오해를 막고, 모든 데이터를 일관되게 표시할 수 있습니다.
