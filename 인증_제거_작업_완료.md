# 인증/권한 제거 작업 완료

## 삭제한 파일 목록

1. ✅ `app/login/page.tsx` - 로그인 페이지
2. ✅ `app/api/auth/[...nextauth]/route.ts` - NextAuth API
3. ✅ `lib/authz.ts` - 권한 체크 유틸리티
4. ✅ `middleware.ts` - 인증 미들웨어

---

## 수정한 파일 목록

### 1. API Routes (인증 체크 제거)

#### `app/api/health/route.ts`
- ✅ `requireSession()` 제거
- ✅ 에러 처리 단순화

#### `app/api/farms/summary/route.ts`
- ✅ `requireSession()` 제거
- ✅ 권한 체크 로직 제거 (모든 농장 조회)
- ✅ 에러 처리 단순화

#### `app/api/farms/[registNo]/detail/route.ts`
- ✅ `requireSession()`, `assertFarmAllowed()` 제거
- ✅ 에러 처리 단순화

#### `app/api/rooms/[key12]/route.ts`
- ✅ `requireSession()`, `assertKey12Allowed()` 제거
- ✅ 에러 처리 단순화 (Not Found만 유지)

#### `app/api/rooms/[key12]/logs/route.ts`
- ✅ `requireSession()`, `assertKey12Allowed()` 제거
- ✅ 에러 처리 단순화

---

### 2. 페이지 컴포넌트 (인증 관련 코드 제거)

#### `app/farms/page.tsx`
- ✅ `useSession()` 제거
- ✅ 인증 체크 useEffect 제거
- ✅ owner 자동 리다이렉트 로직 제거
- ✅ `enabled: status === "authenticated"` 제거

#### `app/farms/[registNo]/page.tsx`
- ✅ `useSession()` 제거

#### `app/providers.tsx`
- ✅ `SessionProvider` 제거
- ✅ `QueryClientProvider`만 유지

---

### 3. UI 컴포넌트

#### `components/shell/TopBar.tsx`
- ✅ `useSession()`, `signOut()` 제거
- ✅ 사용자 표시 제거
- ✅ 로그아웃 버튼 제거
- ✅ 단순 헤더만 유지

---

### 4. 패키지

#### `package.json`
- ✅ `next-auth` 제거
- ✅ `bcryptjs` 제거
- ✅ `@types/bcryptjs` 제거
- ✅ `next-themes` 제거

---

### 5. 환경변수 및 문서

#### `.env.local.example`
- ✅ `NEXTAUTH_SECRET` 제거
- ✅ `NEXTAUTH_URL` 제거
- ✅ 유지: `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY`, `OFFLINE_*`

#### `README_SETUP.md`
- ✅ 로그인 관련 내용 전부 제거
- ✅ 계정 생성 가이드 제거
- ✅ "로컬 UI/UX 테스트" 기준으로 재작성

---

## 변경 사항 요약

### Before (인증 있음)
- 로그인 페이지 필요
- 모든 API에서 인증 체크
- owner/admin 권한 구분
- TopBar에 사용자 정보 표시

### After (인증 없음)
- ✅ 바로 `/farms` 페이지 접근
- ✅ 모든 API 인증 없이 동작
- ✅ 모든 농장 데이터 접근 가능
- ✅ TopBar 단순화

---

## 로컬 실행 방법

```bash
cd Local_PC/iot-dashboard
npm install
npm run dev
```

브라우저에서 `http://localhost:3000` 접속 → 바로 `/farms` 페이지로 이동

---

## UI 동작 확인 체크리스트

### 1. 기본 플로우
- [ ] 루트 (`/`) → `/farms` 자동 리다이렉트
- [ ] `/farms` 페이지 로드
- [ ] KPI 카드 표시 (정상/경고/위험/오프라인)
- [ ] 농장 테이블 표시
- [ ] 검색/정렬 필터 작동

### 2. 농장 상세
- [ ] `/farms/[registNo]` 페이지 로드
- [ ] Stall 탭 전환 (1/2/3)
- [ ] Room 그리드 표시 (20개)
- [ ] RoomCard 클릭 시 Drawer 열림

### 3. Room Drawer
- [ ] 센서 5종 배열 표시
- [ ] 모터 (EC01 + activeVent) 표시
- [ ] "방 상세 페이지 이동" 버튼 작동

### 4. 방 상세 페이지
- [ ] `/rooms/[key12]` 페이지 로드
- [ ] Full 정보 표시
- [ ] 트렌드 차트 표시 (최근 1시간/24시간)

### 5. 반응형
- [ ] 모바일: KpiCards 1열
- [ ] 태블릿: KpiCards 2열
- [ ] 데스크톱: KpiCards 4열

---

## 유지된 기능

✅ **Backend2 API Routes** - 모든 기능 유지
✅ **시간대 KST 규칙** - serverNowKst, measureTsKst 등
✅ **센서/모터 표시 규칙** - Full DTO 구조
✅ **요약/상세 분리** - 15초/3초 폴링
✅ **OFFLINE 판정** - p95 기반 동적 임계값
✅ **shadcn/ui 컴포넌트** - 모든 마이그레이션 유지

---

## 다음 단계 (Phase 2)

인증/권한 시스템을 재설계할 때:
- 새로운 인증 방식 선택 (NextAuth v5, Auth.js, 또는 커스텀)
- 권한 테이블 재설계
- API Routes에 인증 체크 재추가

---

## 참고

- 현재는 UI/UX 구현에만 집중
- 모든 데이터 접근 가능 (로컬 테스트 환경)
- Phase 2에서 보안 강화 예정
